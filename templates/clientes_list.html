{% extends 'base.html' %}

{% block content %}
<div class="row">
	<div class="col-12">
		<div class="card shadow-sm mt-4">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h5 class="text-white mb-0">Catálogo de Clientes</h5>
				<a href="{% url 'redeco_frontend:clientes_create' %}" class="btn btn-sm btn-light">
					<i class="bi bi-plus-circle"></i> Nuevo Cliente
				</a>
			</div>
			<div class="card-body">
				{% if create_success %}
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					{{ create_success }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
				{% endif %}

				{% if update_success %}
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					{{ update_success }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
				{% endif %}

				{% if delete_success %}
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					{{ delete_success }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
				{% endif %}

				{% if delete_error %}
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					{{ delete_error }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
				{% endif %}

				{% if clientes %}
				<div class="table-responsive">
					<table class="table table-hover table-striped">
						<thead class="table-dark">
							<tr>
								<th>ID</th>
								<th>Nombre</th>
								<th>RFC</th>
								<th>Tipo</th>
								<th>Estado</th>
								<th>CP</th>
								<th>Municipio</th>
								<th>Colonia</th>
								<th>Sexo</th>
								<th>Edad</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody>
							{% for cliente in clientes %}
							<tr>
								<td>{{ cliente.id }}</td>
								<td>{{ cliente.nombre }}</td>
								<td>{{ cliente.rfc }}</td>
								<td>
									{% if cliente.tipo_persona == 1 %}
										<span class="badge bg-info">Física</span>
									{% else %}
										<span class="badge bg-secondary">Moral</span>
									{% endif %}
								</td>
								<td>{{ cliente.estado_nombre|default:cliente.estado_id }}</td>
								<td>{{ cliente.codigo_postal }}</td>
								<td>{{ cliente.municipio_nombre|default:cliente.municipio_id|default:'-' }}</td>
								<td>{{ cliente.colonia_nombre|default:cliente.colonia_id|default:'-' }}</td>
								<td>{{ cliente.sexo|default:'-' }}</td>
								<td>{{ cliente.edad|default:'-' }}</td>
								<td>
									<div class="btn-group btn-group-sm" role="group">
										<a href="{% url 'redeco_frontend:clientes_edit' cliente.id %}" 
										   class="btn btn-outline-primary" title="Editar">
											<i class="bi bi-pencil"></i>
										</a>
										<button type="button" class="btn btn-outline-danger" 
												data-bs-toggle="modal" 
												data-bs-target="#deleteModal{{ cliente.id }}" 
												title="Eliminar">
											<i class="bi bi-trash"></i>
										</button>
									</div>

									<!-- Modal de confirmación de eliminación -->
									<div class="modal fade" id="deleteModal{{ cliente.id }}" tabindex="-1">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title">Confirmar eliminación</h5>
													<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
												</div>
												<div class="modal-body">
													¿Estás seguro de que deseas eliminar al cliente <strong>{{ cliente.nombre }}</strong> ({{ cliente.rfc }})?
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
													<form method="post" action="{% url 'redeco_frontend:clientes_delete' cliente.id %}" style="display:inline;">
														{% csrf_token %}
														<button type="submit" class="btn btn-danger">Eliminar</button>
													</form>
												</div>
											</div>
										</div>
									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				{% else %}
				<div class="alert alert-info">
					No hay clientes registrados. <a href="{% url 'redeco_frontend:clientes_create' %}">Crear el primero</a>
				</div>
				{% endif %}

				<div class="mt-3">
					<a href="{% url 'redeco_frontend:index' %}" class="btn btn-secondary">Volver al Dashboard</a>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
